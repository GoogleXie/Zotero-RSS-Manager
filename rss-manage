import sqlite3
import tkinter as tk
from tkinter import simpledialog, messagebox

# Connect to Zotero SQLite database
def connect_zotero_db(db_path):
    try:
        conn = sqlite3.connect(db_path)
        return conn
    except Exception as e:
        print(f"Failed to connect to Zotero database: {e}")
        return None

# Retrieve folder structure from the database
def get_zotero_collections(conn):
    cursor = conn.cursor()
    query = """
    SELECT collectionName, collectionID 
    FROM collections
    """
    cursor.execute(query)
    collections = cursor.fetchall()
    return collections

# Prompt user to select main library and RSS storage folders
def prompt_folder_selection(collections):
    root = tk.Tk()
    root.withdraw()  # Hide the main Tkinter window
    messagebox.showinfo("Folder Selection", "Please choose folders for your library and RSS feeds.")

    library_folders = []
    rss_folders = []

    for collection in collections:
        folder_name = collection[0]
        answer = simpledialog.askstring("Select Folder Type", 
                                        f"Folder '{folder_name}': Type 'library' for main storage, 'rss' for RSS feeds, or skip.")
        if answer == 'library':
            library_folders.append(folder_name)
        elif answer == 'rss':
            rss_folders.append(folder_name)

    return library_folders, rss_folders

# Main function
def main():
    # Specify the path to your Zotero database here
    db_path = input("Enter the path to your Zotero database (e.g., C:/Users/YourUserName/Zotero/zotero.sqlite): ")
    
    conn = connect_zotero_db(db_path)
    if conn:
        collections = get_zotero_collections(conn)
        library_folders, rss_folders = prompt_folder_selection(collections)
        
        print("\nSelected Library Folders:")
        for folder in library_folders:
            print(f"- {folder}")
        
        print("\nSelected RSS Feed Folders:")
        for folder in rss_folders:
            print(f"- {folder}")
        
        conn.close()
    else:
        print("Connection to Zotero database failed.")

if __name__ == "__main__":
    main()
